{% extends 'base.html' %}
{% block title %}System Summary{% endblock %}
{% block content %}
<div class="container py-5">
  <h2 class="mb-4 text-center">System Summary (Last 24 Hours)</h2>
  <div class="row mb-4">
    <div class="col-md-3 mb-3">
      <div class="card text-center shadow-sm h-100">
        <div class="card-body">
          <div class="display-6 mb-2">üöó</div>
          <h5 class="card-title">Currently Parked</h5>
          <h2 class="fw-bold">{{ current_parked|length }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card text-center shadow-sm h-100">
        <div class="card-body">
          <div class="display-6 mb-2">‚¨ÖÔ∏è</div>
          <h5 class="card-title">Cars Left (24h)</h5>
          <h2 class="fw-bold">{{ left_24h|length }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card text-center shadow-sm h-100">
        <div class="card-body">
          <div class="display-6 mb-2">üí∞</div>
          <h5 class="card-title">Collected (24h)</h5>
          <h4 class="fw-bold">‚Çπ{{ '%.2f'|format(revenue_24h) }}</h4>
          <small class="text-muted">from completed sessions</small>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card text-center shadow-sm h-100">
        <div class="card-body">
          <div class="display-6 mb-2">‚è≥</div>
          <h5 class="card-title">Estimated (24h)</h5>
          <h4 class="fw-bold">‚Çπ{{ '%.2f'|format(estimated_current_revenue) }}</h4>
          <small class="text-muted">from active sessions</small>
        </div>
      </div>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">Currently Parked Cars</h5>
          <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle">
              <thead class="table-light">
                <tr>
                  <th>Vehicle</th>
                  <th>User</th>
                  <th>Spot</th>
                  <th>Duration</th>
                  <th>Est. Cost</th>
                </tr>
              </thead>
              <tbody>
                {% for reservation, spot, lot, user in current_parked %}
                <tr>
                  <td>{{ user.vehicle_number or 'N/A' }}</td>
                  <td>{{ user.full_name or user.username }}</td>
                  <td>Spot {{ spot.id }} @ {{ lot.prime_location_name }}</td>
                  <td>
                    {% set duration = (now - reservation.parking_timestamp) %}
                    {{ '%d hrs %d min'|format(duration.seconds // 3600, (duration.seconds % 3600) // 60) }}
                  </td>
                  <td>
                    ‚Çπ{{ '%.2f'|format(lot.price * (duration.seconds / 3600)) }}
                  </td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="text-center">No cars currently parked.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Cars Taken Away (Last 24h)</h5>
          <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle">
              <thead class="table-light">
                <tr>
                  <th>Vehicle Number</th>
                  <th>User</th>
                  <th>Spot ID</th>
                  <th>Out At</th>
                  <th>Cost</th>
                </tr>
              </thead>
              <tbody>
                {% for r in left_24h %}
                <tr>
                  <td>{{ r.user.vehicle_number }}</td>
                  <td>{{ r.user.full_name or r.user.username }}</td>
                  <td>{{ r.spot_id }}</td>
                  <td>{{ r.leaving_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                  <td>‚Çπ{{ '%.2f'|format(r.total_cost or 0) }}</td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="text-center">No cars taken away in last 24 hours.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="text-center">
    <a href="/admin_dashboard" class="btn btn-secondary">Back to Admin Dashboard</a>
  </div>
</div>
{% endblock %} 