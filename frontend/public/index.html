<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Parking App V2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.8/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
        }
        body {
            background-color: #f5f5f5;
            min-height: 100vh;
        }
        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
        }
        .sidebar {
            min-height: calc(100vh - 56px);
            background: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            border-radius: 8px;
            margin: 5px 10px;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .stat-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, #45a049 100%);
            color: white;
        }
        .stat-card.blue {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #1976D2 100%);
        }
        .stat-card.orange {
            background: linear-gradient(135deg, var(--accent-color) 0%, #F57C00 100%);
        }
        .stat-card.purple {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
        }
        .parking-spot {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        .parking-spot.available {
            background: #e8f5e9;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        .parking-spot.occupied {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #c62828;
        }
        .parking-spot:hover {
            transform: scale(1.1);
        }
        .btn-primary {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }
        .btn-primary:hover {
            background: #45a049;
            border-color: #45a049;
        }
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .login-card {
            max-width: 400px;
            width: 100%;
            padding: 40px;
            border-radius: 20px;
            background: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(76, 175, 80, 0.25);
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .table th {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div id="app">
        <div v-if="loading" class="loading-overlay">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        
        <div class="toast-container">
            <div v-for="toast in toasts" :key="toast.id" 
                 class="toast show" :class="'bg-' + toast.type" role="alert">
                <div class="toast-body text-white d-flex justify-content-between align-items-center">
                    {{ toast.message }}
                    <button type="button" class="btn-close btn-close-white" @click="removeToast(toast.id)"></button>
                </div>
            </div>
        </div>
        
        <template v-if="!isAuthenticated">
            <div class="login-container">
                <div class="login-card">
                    <div class="text-center mb-4">
                        <i class="bi bi-car-front-fill text-primary" style="font-size: 3rem;"></i>
                        <h2 class="mt-3">Vehicle Parking App</h2>
                        <p class="text-muted">{{ isLogin ? 'Sign in to your account' : 'Create a new account' }}</p>
                    </div>
                    
                    <form @submit.prevent="isLogin ? login() : register()">
                        <div class="mb-3" v-if="isLogin">
                            <label class="form-label">Login as</label>
                            <select class="form-select" v-model="loginForm.role">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" v-model="loginForm.username" required>
                        </div>
                        
                        <template v-if="!isLogin">
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" v-model="loginForm.email">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" v-model="loginForm.full_name">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Vehicle Number</label>
                                <input type="text" class="form-control" v-model="loginForm.vehicle_number" placeholder="e.g., MH01AB1234">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" v-model="loginForm.phone">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Address</label>
                                <textarea class="form-control" v-model="loginForm.address" rows="2"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Pin Code</label>
                                <input type="text" class="form-control" v-model="loginForm.pin_code">
                            </div>
                        </template>
                        
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" v-model="loginForm.password" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            {{ isLogin ? 'Login' : 'Register' }}
                        </button>
                        
                        <p class="text-center mb-0">
                            <span v-if="isLogin">
                                Don't have an account? 
                                <a href="#" @click.prevent="isLogin = false">Register</a>
                            </span>
                            <span v-else>
                                Already have an account? 
                                <a href="#" @click.prevent="isLogin = true">Login</a>
                            </span>
                        </p>
                    </form>
                </div>
            </div>
        </template>
        
        <template v-else>
            <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        <i class="bi bi-car-front-fill me-2"></i>
                        Vehicle Parking App
                    </a>
                    <div class="d-flex align-items-center">
                        <span class="badge bg-primary me-3">{{ user.role }}</span>
                        <span class="me-3">Welcome, {{ user.full_name || user.username }}</span>
                        <button class="btn btn-outline-danger btn-sm" @click="logout">
                            <i class="bi bi-box-arrow-right"></i> Logout
                        </button>
                    </div>
                </div>
            </nav>
            
            <div class="container-fluid">
                <div class="row">
                    <nav class="col-md-2 sidebar py-3">
                        <ul class="nav flex-column">
                            <template v-if="user.role === 'admin'">
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'dashboard'}" href="#" @click.prevent="currentView = 'dashboard'">
                                        <i class="bi bi-speedometer2"></i> Dashboard
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'parking-lots'}" href="#" @click.prevent="currentView = 'parking-lots'">
                                        <i class="bi bi-geo-alt"></i> Parking Lots
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'users'}" href="#" @click.prevent="currentView = 'users'">
                                        <i class="bi bi-people"></i> Users
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'summary'}" href="#" @click.prevent="currentView = 'summary'">
                                        <i class="bi bi-bar-chart"></i> Summary
                                    </a>
                                </li>
                            </template>
                            <template v-else>
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'dashboard'}" href="#" @click.prevent="currentView = 'dashboard'">
                                        <i class="bi bi-house"></i> Home
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'book'}" href="#" @click.prevent="currentView = 'book'">
                                        <i class="bi bi-plus-circle"></i> Book Spot
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'history'}" href="#" @click.prevent="currentView = 'history'">
                                        <i class="bi bi-clock-history"></i> History
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'summary'}" href="#" @click.prevent="currentView = 'summary'">
                                        <i class="bi bi-graph-up"></i> Summary
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" :class="{active: currentView === 'profile'}" href="#" @click.prevent="currentView = 'profile'">
                                        <i class="bi bi-person"></i> Profile
                                    </a>
                                </li>
                            </template>
                        </ul>
                    </nav>
                    
                    <main class="col-md-10 p-4">
                        <template v-if="user.role === 'admin'">
                            <admin-dashboard v-if="currentView === 'dashboard'" :api="api" @show-toast="showToast"></admin-dashboard>
                            <parking-lots-manager v-if="currentView === 'parking-lots'" :api="api" @show-toast="showToast"></parking-lots-manager>
                            <users-list v-if="currentView === 'users'" :api="api" @show-toast="showToast"></users-list>
                            <admin-summary v-if="currentView === 'summary'" :api="api" @show-toast="showToast"></admin-summary>
                        </template>
                        <template v-else>
                            <user-dashboard v-if="currentView === 'dashboard'" :api="api" :user="user" @show-toast="showToast" @refresh-user="loadUser"></user-dashboard>
                            <book-spot v-if="currentView === 'book'" :api="api" :user="user" @show-toast="showToast"></book-spot>
                            <booking-history v-if="currentView === 'history'" :api="api" @show-toast="showToast"></booking-history>
                            <user-summary v-if="currentView === 'summary'" :api="api" @show-toast="showToast"></user-summary>
                            <user-profile v-if="currentView === 'profile'" :api="api" :user="user" @show-toast="showToast" @update-user="updateUser"></user-profile>
                        </template>
                    </main>
                </div>
            </div>
        </template>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
